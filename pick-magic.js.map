{"version":3,"sources":["assets/js/app/click-handler.js","assets/js/app/controller.js","assets/js/app/pwa.js","assets/js/app/search-service.js","assets/js/app/song-history.js","assets/js/app/song-list-renderer.js","assets/js/app/song-list.js","assets/js/app/song-renderer.js","assets/js/app/song-repository.js"],"names":[],"mappings":"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","file":"pick-magic.js","sourcesContent":["/**\n * Okay, so why do we need this? Why a whole class to implement our own version\n * of click handling? Am I insane?\n *\n * Well, maybe, but not because of this.\n *\n * This class installs one single click handler on the whole document, and\n * evaluates which callback to call at click time, based on the element that has\n * been clicked. This allows us to swap out and rerender whole sections of the\n * DOM without having to reinstall a bunch of click handlers each time. This\n * nicely decouples the render logic from the click event management logic.\n */\n\nclass ClickHandler {\n\n  constructor() {\n    document.addEventListener('click', (e) => this.handleClick(e));\n    this.handlers = {};\n  }\n\n  handleClick(e) {\n    Object.keys(this.handlers).forEach((selector) => {\n      if (e.target.matches(selector)) {\n        this.handlers[selector](e.target);\n      }\n    });\n  }\n\n  register(selector, callback) {\n    this.handlers[selector] = callback;\n  }\n\n}\n","window.addEventListener('load', function() {\n\n  let songRepository   = new SongRepository();\n  let songHistory      = new SongHistory(songRepository);\n  let songListRenderer = new SongListRenderer(document.getElementById(\"song-list\"));\n  let songRenderer     = new SongRenderer(document.getElementById(\"song\"));\n  let clickHandler     = new ClickHandler();\n  let searchService    = new SearchService();\n\n  // Bind click handlers\n  clickHandler.register('[data-page-link]', selectPage);\n  clickHandler.register('[data-song-link]', selectSong);\n  clickHandler.register('[name=chords]',    search);\n\n  // Bind form submit handler to the search function\n  document.querySelectorAll('#search-control')\n          .forEach((b) => b.addEventListener('submit', search));\n\n  // Bootstrap song list\n  renderHistory();\n\n  // Helper event handlers\n\n  function selectPage(elm) {\n    document.querySelectorAll('.page').forEach((e) => {e.classList.remove('active')});\n    document.getElementById(elm.getAttribute('data-page-link')).classList.add('active');\n    window.scrollTo(0,0);\n  }\n\n  function selectSong(elm) {\n    let song = songRepository.getSong(elm.getAttribute('data-song-link'));\n    songRenderer.draw(song);\n    songHistory.add(song);\n  }\n\n  function renderHistory() {\n    songListRenderer.draw(songHistory.getSongList(), 'Recent songs');\n  }\n\n  function search(e) {\n    let query  = document.getElementById(\"search-song\").value;\n    let chords = Array.from(document.getElementsByName('chords'))\n                      .filter((checkbox) => checkbox.checked)\n                      .map((checkbox) => checkbox.id);\n\n    if (query == \"\" && chords.length == 0) {\n      renderHistory();\n    } else {\n      searchService.search(query, chords, (songList) => {\n        songRepository.add(songList);\n        songListRenderer.draw(songList, 'Search results');\n      });\n    }\n\n    if (e.preventDefault) e.preventDefault();\n    return false;\n  }\n\n});\n","// Install Service worker\n\nif ('serviceWorker' in navigator) {\n  navigator.serviceWorker.register('service-worker.js');\n}\n\n// PWA install prompt\n//\n// let deferredPrompt;\n// window.addEventListener('beforeinstallprompt', (e) => {\n//   // Prevent Chrome 67 and earlier from automatically showing the prompt\n//   e.preventDefault();\n//   // Stash the event so it can be triggered later.\n//   deferredPrompt = e;\n//   // Show the install button\n//   document.querySelectorAll('.install-button').forEach(function(b) {\n//     b.classList.add('active');\n//     b.addEventListener('click', install2HS);\n//   });\n// });\n//\n// function install2HS() {\n//   // Hide install button\n//   document.querySelectorAll('.install-button').forEach(function(b) {\n//     b.classList.remove('active');\n//   });\n//\n//   deferredPrompt.prompt();\n//   deferredPrompt.userChoice.then((choiceResult) => {\n//     if (choiceResult.outcome !== 'accepted') {\n//       document.querySelectorAll('.install-button').forEach(function(b) {\n//         b.classList.add('active');\n//       });\n//     }\n//   });\n// }\n","class SearchService {\n\n  constructor() {\n    // Where does Bob's awesome API live?\n    this.webservice = \"https://limitless-bastion-37095.herokuapp.com/api/songs\";\n  }\n\n  // Expects a query string, an array of chords (in the form of strings) and a\n  // callback function for when we have a response\n  search(query, chords, callback) {\n    let parameters = chords.map((chord) => `chord=${encodeURIComponent(chord)}`);\n    if (query) parameters.push(`query=${encodeURIComponent(query)}`);\n\n    this._getRequest(`${this.webservice}?${parameters.join('&')}`, callback);\n  }\n\n  _getRequest(url, callback) {\n    let request = new XMLHttpRequest();\n    request.open('GET', url, true);\n    request.onload = () => {\n      if (request.status >= 200 && request.status < 400) {\n        try {\n          let songList = JSON.parse(request.responseText);\n          callback(new SongList(songList));\n        } catch(e) {\n          console.log(\"Error parsing JSON: \", e);\n        }\n      } else {\n        console.log(\"Server returned an error:\", request);\n      }\n    };\n    request.onerror = () => console.log(\"Could not connect\", request);\n    request.send();\n  }\n\n}\n","class SongHistory {\n\n  constructor(repository) {\n    this.repository = repository;\n  }\n\n  getSongList() {\n    return new SongList(this._list().map((id) => {\n      return this.repository.getSong(id);\n    }));\n  }\n\n  add(song) {\n    if (this._includes(song)) {\n      // Optional TODO: Push this song to the end of the list\n      return;\n    } else {\n      let songHistory = this._list();\n      songHistory.unshift(song.id);\n      songHistory = songHistory.slice(0,10);\n      localStorage.setItem('songHistory', JSON.stringify(songHistory));\n    }\n  }\n\n  _list() {\n    return JSON.parse(localStorage.getItem('songHistory') || \"[]\");\n  }\n\n  _includes(song) {\n    return this._list().includes(song.id);\n  }\n\n}\n","class SongListRenderer {\n\n  constructor(element) {\n    this.element = element;\n  }\n\n  draw(songlist, header) {\n    let list = '';\n    songlist.forEach((song) => {\n      list += `<li><a class='song-link' data-page-link='song-page' data-song-link='${song.id}'>${song.song_name} - ${song.artist_name}</a></li>`;\n    });\n\n    this.element.innerHTML = `\n      ${header ? `<h1>${header} (${songlist.length})</h1>` : ``}\n      <ul>\n        ${list}\n      </ul>\n    `;\n  }\n\n}\n","class SongList extends Array {\n\n  constructor(songs) {\n    super();\n    if (Array.isArray(songs)) {\n      songs.forEach((song) => this.push(song));\n    }\n  }\n\n}\n","class SongRenderer {\n\n  constructor(element) {\n    this.element = element;\n  }\n\n  draw(song) {\n    this.element.innerHTML = `\n      <h1>${song.song_name} - ${song.artist_name}</h1>\n      <pre>${this._markupChords(song.lyrics)}</pre>\n    `;\n  }\n\n  _markupChords(lyrics) {\n    return lyrics.replace(/\\[ch\\]([\\w\\#\\/\\\\]*)\\[\\/ch\\]/gi, \"<span class='chord'>$1</span>\");\n  }\n\n}\n","class SongRepository {\n\n  constructor() {\n    this.repository = JSON.parse(localStorage.getItem('songList') || \"{}\");\n  }\n\n  add(songlist) {\n    songlist.forEach((song) => this._addSong(song, false));\n    this._saveToLocalStorage();\n  }\n\n  getSong(id) {\n    return this.repository[id];\n  }\n\n  getSongList() {\n    return new SongList(Object.values(this.repository));\n  }\n\n  _addSong(song, saveToLocalStorage=true) {\n    this.repository[song.id] = song;\n    if (saveToLocalStorage) this._saveToLocalStorage();\n  }\n\n  _saveToLocalStorage() {\n    localStorage.setItem('songList', JSON.stringify(this.repository));\n  }\n\n}\n"]}