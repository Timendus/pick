{"version":3,"sources":["assets/js/index.js"],"names":[],"mappings":"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","file":"pick-magic.js","sourcesContent":["window.addEventListener('load', function() {\n\n  console.log(\"Initializing Pick\");\n\n  // Service worker install\n\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.register('service-worker.js');\n  }\n\n  // PWA install prompt\n\n  let deferredPrompt;\n  window.addEventListener('beforeinstallprompt', (e) => {\n    // Prevent Chrome 67 and earlier from automatically showing the prompt\n    e.preventDefault();\n    // Stash the event so it can be triggered later.\n    deferredPrompt = e;\n    // Show the install button\n    document.querySelectorAll('.install-button').forEach(function(b) {\n      b.classList.add('active');\n      b.addEventListener('click', install2HS);\n    });\n  });\n\n  function install2HS() {\n    // Hide install button\n    document.querySelectorAll('.install-button').forEach(function(b) {\n      b.classList.remove('active');\n    });\n\n    deferredPrompt.prompt();\n    deferredPrompt.userChoice.then((choiceResult) => {\n      if (choiceResult.outcome !== 'accepted') {\n        document.querySelectorAll('.install-button').forEach(function(b) {\n          b.classList.add('active');\n        });\n      }\n    });\n  }\n\n  // Global song list\n\n  function getSongList() {\n    return JSON.parse(localStorage.getItem('songList') || \"{}\");\n  }\n\n  function getSong(id) {\n    return getSongList()[id];\n  }\n\n  function addSongs(list) {\n    var newList = Object.assign(getSongList(), list);\n    localStorage.setItem('songList', JSON.stringify(newList));\n  }\n\n  // Global song history\n\n  function updateSongHistory(song) {\n    var songHistory = JSON.parse(localStorage.getItem('songHistory') || \"[]\");\n    if ( songHistory.includes(song.id) ) { return; }\n    songHistory.push(song.id);\n    songHistory = songHistory.slice(0,10);\n    localStorage.setItem('songHistory', JSON.stringify(songHistory));\n  }\n\n  // Navigation\n\n  function selectPage(page) {\n    document.querySelectorAll('.page').forEach(function(e) {e.classList.remove('active')});\n    document.getElementById(page).classList.add('active');\n    window.scrollTo(0,0);\n  }\n\n  // Searching\n\n  function searchSong(e) {\n      e.preventDefault();\n      query = document.getElementById(\"search-song\").value;\n      if ( query == \"\" ) { renderHistory(); return false; }\n      var request = new XMLHttpRequest();\n      request.open('GET', 'https://limitless-bastion-37095.herokuapp.com/api/songs?query='+encodeURIComponent(query), true);\n      request.onload = function() {\n        if (request.status >= 200 && request.status < 400) {\n          // Success!\n          try {\n            var song_list = JSON.parse(request.responseText);\n          } catch(e) {\n            console.log(\"Error parsing JSON: \", e);\n          }\n\n          // You could reformat the data in the right format as well:\n          const products = song_list.reduce((obj, product) => {\n            obj[product.id] = product\n            return obj\n          }, {});\n\n          addSongs(products);\n          render(products);\n        } else {\n          console.log(\"Server returned an error:\", request);\n        }\n      };\n      request.onerror = function() { console.log(\"Could not connect\", request); };\n      request.send();\n      return false;\n  }\n\n  // Displaying lists of sings\n  function searchChords(e){\n    var chordsChecked = Array.from(document.getElementsByName('chords')).filter((checkbox) => checkbox.checked).map((checkbox) => `chord=${encodeURIComponent(checkbox.id)}`);\n    var query = chordsChecked.join('&');\n    if ( query == \"\" ) { renderHistory(); return false; }\n    var request = new XMLHttpRequest();\n    request.open('GET', 'https://limitless-bastion-37095.herokuapp.com/api/songs?'+ query, true);\n    request.onload = function() {\n      if (request.status >= 200 && request.status < 400) {\n        // Success!\n        try {\n          var song_list = JSON.parse(request.responseText);\n        } catch(e) {\n          console.log(\"Error parsing JSON: \", e);\n        }\n\n        // You could reformat the data in the right format as well:\n        const products = song_list.reduce((obj, product) => {\n          obj[product.id] = product\n          return obj\n        }, {});\n\n        addSongs(products);\n        render(products);\n      } else {\n        console.log(\"Server returned an error:\", request);\n      }\n    };\n    request.onerror = function() { console.log(\"Could not connect\", request); };\n    request.send();\n    return false;\n  }\n\n  function renderHistory() {\n      var songHistory = JSON.parse(localStorage.getItem('songHistory') || \"[]\");\n      var songHistoryList = songHistory.map(function(id) { return getSong(id); });\n      render(songHistoryList.reverse(), false);\n  }\n\n  function render(songList, searchResults=true) {\n    // Refresh list\n    document.getElementById(\"song-list\").innerHTML = generateSongList(songList);\n    if ( searchResults ) {\n      document.querySelector(\"#list-page h1\").innerText = \"Search results\";\n    } else {\n      document.querySelector(\"#list-page h1\").innerText = \"Recent songs\";\n    }\n\n    // Update event handlers\n    document.querySelectorAll('.song-link').forEach(function(b) {\n      b.addEventListener('click', function(e) {\n        selectSong(e.target.getAttribute('song-id'));\n      });\n    });\n  }\n\n  function generateSongList(songList) {\n    var html = \"\";\n    Object.entries(songList).forEach(function(song) {\n      html += \"<li><a class='song-link' song-id='\"+song[1].id+\"'>\"+song[1].song_name+\" - \"+song[1].artist_name+\"</a></li>\";\n    });\n    return html;\n  }\n\n  // Displaying individual songs\n\n  function markupChords(lyrics) {\n    return lyrics.replace(/\\[ch\\]([\\w\\#\\/\\\\]*)\\[\\/ch\\]/gi, \"<span class='chord'>$1</span>\");\n  }\n\n  function selectSong(id) {\n    var song = getSong(id);\n    document.getElementById(\"song-title\").innerHTML = song.song_name + \" - \" + song.artist_name;\n    document.getElementById(\"song-lyrics\").innerHTML = markupChords(song.lyrics);\n    selectPage('song-page');\n    updateSongHistory(song);\n  }\n\n\n\n  // Attach events to buttons\n  document.querySelectorAll('#search-control').forEach(function(b) {\n    b.addEventListener('submit', searchSong);\n  });\n  document.querySelectorAll('.back-button').forEach(function(b) {\n    b.addEventListener('click', function() {\n      selectPage('list-page');\n    });\n  });\n  document.getElementsByName('chords').forEach(el => el.addEventListener('click', searchChords));\n\n  renderHistory();\n});\n"]}